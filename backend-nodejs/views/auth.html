<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Documentation - Multaqana</title>

    <!-- Style CSS (Includes Materialize & Fonts) -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

</head>

<body>

    <!-- Sidenav -->
    <ul id="slide-out" class="sidenav sidenav-fixed">
        <li>
            <div class="logo-text text-indigo">Multaqana<span style="color:#757575;">API</span></div>
        </li>
        <li>
            <div class="divider"></div>
        </li>

        <li>
            <div class="subheader">Getting Started</div>
        </li>
        <li><a href="#intro" class="waves-effect">Introduction</a></li>
        <li><a href="#security" class="waves-effect">Security & Tokens</a></li>

        <li>
            <div class="subheader">Endpoints</div>
        </li>
        <li><a href="#register" class="waves-effect"><span class="new badge green left"
                    data-badge-caption="POST"></span> Register</a></li>
        <li><a href="#login" class="waves-effect"><span class="new badge blue left" data-badge-caption="POST"></span>
                Login</a></li>
        <li><a href="#logout" class="waves-effect"><span class="new badge grey left" data-badge-caption="POST"></span>
                Logout</a></li>
    </ul>

    <!-- Main Content -->
    <main>
        <!-- Hamburger for mobile -->
        <a href="#" data-target="slide-out" class="sidenav-trigger btn-flat hide-on-large-only"><i
                class="material-icons">menu</i></a>

        <!-- Introduction -->
        <section id="intro">
            <h2 class="white-text">Authentication Guide</h2>
            <p class="flow-text grey-text text-lighten-1">
                A complete reference for frontend developers integrating with the Multaqana API.
                This system uses <strong>JWT</strong> for stateless, secure authentication.
            </p>
            <div class="card-panel card-panel-dark" style="border-left: 4px solid #2196F3;">
                <span class="blue-text text-lighten-2"><strong>Base URL:</strong></span>
                <code class="white-text"
                    style="background: #333; padding: 2px 6px; border-radius: 4px;">http://localhost:5000/api/auth</code>
            </div>
        </section>

        <!-- Security Primer -->
        <section id="security">
            <h4><i class="material-icons left blue-text">security</i>Security & Token Strategy</h4>
            <div class="row">
                <!-- Access Token -->
                <div class="col s12 m6">
                    <div class="card card-panel-dark">
                        <div class="card-content">
                            <span class="card-title blue-text">ðŸ”‘ Access Token</span>
                            <p>Short-lived token (15 mins) used to authenticate API requests.</p>
                            <br>
                            <ul class="browser-default grey-text">
                                <li><strong>Format:</strong> JWT</li>
                                <li><strong>Storage:</strong> <span class="red-text text-lighten-2">In Memory (React
                                        State)</span></li>
                                <li><strong>Header:</strong> <code>Authorization: Bearer [token]</code></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Refresh Token -->
                <div class="col s12 m6">
                    <div class="card card-panel-dark">
                        <div class="card-content">
                            <span class="card-title green-text">ðŸ”„ Refresh Token</span>
                            <p>Long-lived token (7 days) used to get new Access Tokens.</p>
                            <br>
                            <ul class="browser-default grey-text">
                                <li><strong>Format:</strong> JWT</li>
                                <li><strong>Storage:</strong> <span class="green-text text-lighten-2">HttpOnly
                                        Cookie</span></li>
                                <li><strong>Handling:</strong> Automatic by browser.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-panel card-panel-dark" style="border-left: 4px solid #ff9800;">
                <h6 class="orange-text">Why Cookies?</h6>
                <p>
                    We store the Refresh Token in an <strong>HttpOnly Cookie</strong>. This makes it invisible to
                    JavaScript, preventing XSS attacks from stealing user sessions.
                    Do <strong>NOT</strong> save tokens in LocalStorage.
                </p>
            </div>
        </section>

        <div class="divider"></div>

        <!-- POST /register -->
        <section id="register">
            <div class="row valign-wrapper">
                <div class="col s12">
                    <h4>Register User</h4>
                    <span class="chip-method post">POST</span> <span class="url">/register</span>
                    <p>Creates a new user account. Supports <code class="red-text">multipart/form-data</code> for
                        profile image upload.</p>
                </div>
            </div>

            <!-- Tab Structure -->
            <div class="">
                <div class="col s12">
                    <ul class="tabs tabs-transparent" style="background-color: #1e1e1e;">
                        <li class="tab col s3"><a class="active" href="#reg-params">Parameters</a></li>
                        <li class="tab col s3"><a href="#reg-response">Response</a></li>
                    </ul>
                </div>

                <!-- Tab Content: Params -->
                <div id="reg-params" class="col s12 card-panel-dark p-4">
                    <table class="highlight responsive-table">
                        <thead>
                            <tr>
                                <th>Key</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="blue-text text-lighten-2">username</td>
                                <td class="type-col">String</td>
                                <td class="required">Yes</td>
                                <td>Min 3, Max 30 chars.</td>
                            </tr>
                            <tr>
                                <td class="blue-text text-lighten-2">email</td>
                                <td class="type-col">String</td>
                                <td class="required">Yes</td>
                                <td>Unique valid email.</td>
                            </tr>
                            <tr>
                                <td class="blue-text text-lighten-2">password</td>
                                <td class="type-col">String</td>
                                <td class="required">Yes</td>
                                <td>Min 6 chars.</td>
                            </tr>
                            <tr>
                                <td class="blue-text text-lighten-2">confirmPassword</td>
                                <td class="type-col">String</td>
                                <td class="required">Yes</td>
                                <td>Must match password.</td>
                            </tr>
                            <tr>
                                <td class="blue-text text-lighten-2">image</td>
                                <td class="type-col">File</td>
                                <td class="grey-text">No</td>
                                <td>Profile picture (max 2MB).</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Tab Content: Response -->
                <div id="reg-response" class="col s12 card-panel-dark">
                    <br>
                    <pre class="code-block" style="color: #81c784;">
{
    "success": true,
    "message": "New user john_doe created",
    "data": null
}</pre>
                </div>
            </div>

            <!-- Accordion: React Code -->
            <ul class="collapsible">
                <li>
                    <div class="collapsible-header"><i class="material-icons blue-text">code</i>React Implementation
                        (FormData)</div>
                    <div class="collapsible-body">
                        <div style="position: relative;">
                            <button class="copy-btn" onclick="copyToClipboard('code-reg', this)">Copy</button>
                            <pre id="code-reg" class="code-block">
import axios from 'axios';

const registerUser = async (userData, imageFile) => {
  try {
    // 1. Create FormData (Required for file uploads)
    const formData = new FormData();
    formData.append('username', userData.username);
    formData.append('email', userData.email);
    formData.append('password', userData.password);
    formData.append('confirmPassword', userData.confirmPassword);
    
    // Append file if exists
    if (imageFile) formData.append('image', imageFile); 

    // 2. Make Request
    const res = await axios.post('http://localhost:5000/api/auth/register', formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    });

    console.log('Success:', res.data.message);
    // Redirect to login...
  } catch (err) {
    console.error('Error:', err.response?.data?.message || err.message);
  }
};
</pre>
                        </div>
                    </div>
                </li>
            </ul>
        </section>

        <div class="divider"></div>

        <!-- POST /login -->
        <section id="login">
            <div class="row valign-wrapper">
                <div class="col s12">
                    <h4>Login</h4>
                    <span class="chip-method post">POST</span> <span class="url">/login</span>
                    <p>Authenticates user. Returns Access Token (JSON) and sets Refresh Token (Cookie).</p>
                </div>
            </div>

            <div class="row">
                <div class="col s12">
                    <!-- Table -->
                    <table class="highlight card-panel-dark">
                        <thead>
                            <tr>
                                <th>Key</th>
                                <th>Type</th>
                                <th>Required</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="blue-text text-lighten-2">email</td>
                                <td class="type-col">String</td>
                                <td class="required">Yes</td>
                            </tr>
                            <tr>
                                <td class="blue-text text-lighten-2">password</td>
                                <td class="type-col">String</td>
                                <td class="required">Yes</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- JSON Response -->
            <div class="row">
                <div class="col s12">
                    <h6>Success Response (200 OK)</h6>
                    <pre class="code-block">
{
    "success": true,
    "message": "Login successful",
    "data": {
        "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    }
}</pre>
                </div>
            </div>

            <!-- Accordion: React Code -->
            <ul class="collapsible">
                <li>
                    <div class="collapsible-header"><i class="material-icons blue-text">code</i>React Implementation
                        (Login & State)</div>
                    <div class="collapsible-body">
                        <div style="position: relative;">
                            <button class="copy-btn" onclick="copyToClipboard('code-login', this)">Copy</button>
                            <pre id="code-login" class="code-block">
import axios from 'axios';
// Assume you use a Context Provider for Auth State

const handleLogin = async (email, password) => {
  try {
    const res = await axios.post('http://localhost:5000/api/auth/login', 
      { email, password },
      { 
        headers: { 'Content-Type': 'application/json' },
        withCredentials: true // CRITICAL: Allows browser to save the cookie
      }
    );

    const accessToken = res.data.data.accessToken;
    
    // Save to App State (Memory)
    // setAuth({ token: accessToken }); 

    console.log('Logged In!');
  } catch (err) {
    console.error('Login Failed:', err.response?.data?.message);
  }
};
</pre>
                        </div>
                    </div>
                </li>
            </ul>
        </section>

        <div class="divider"></div>

        <!-- POST /logout -->
        <section id="logout">
            <h4>Logout</h4>
            <span class="chip-method">POST</span> <span class="url">/logout</span>
            <p>Invalidates session and clears cookies.</p>

            <div class="card-panel card-panel-dark">
                <span class="grey-text">React Code:</span>
                <pre class="code-block" style="padding: 10px; margin-top: 5px;">
await axios.post('http://localhost:5000/api/auth/logout', {}, { 
    withCredentials: true 
});
// Then clear your local state
// setAuth({});
            </pre>
            </div>
        </section>

    </main>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var sidenavs = document.querySelectorAll('.sidenav');
            var instances = M.Sidenav.init(sidenavs);

            var tabs = document.querySelectorAll('.tabs');
            M.Tabs.init(tabs);

            var collapsibles = document.querySelectorAll('.collapsible');
            M.Collapsible.init(collapsibles);
        });

        function copyToClipboard(elementId, btnElement) {
            const text = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(text).then(() => {
                const originalText = btnElement.innerText;
                btnElement.innerText = "Copied!";
                btnElement.style.color = "#4CAF50";
                setTimeout(() => {
                    btnElement.innerText = originalText;
                    btnElement.style.color = "#fff";
                }, 2000);
            });
        }
    </script>
</body>

</html>